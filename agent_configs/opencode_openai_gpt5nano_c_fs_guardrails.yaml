extends: opencode_openai_gpt5nano_c_fs_compiled.yaml

guardrails:
  include:
    - implementations/guardrails/base_workspace.yaml
    - implementations/guardrails/execution_baseline.yaml
  overrides:
    zero_tool_watchdog:
      parameters:
        warn_after_turns: 4
        abort_after_turns: 8
    shell_write_block:
      templates:
        validation: implementations/system_prompts/guardrails/shell_write_block_opencode.prompt.md
    todo_rate_limit:
      parameters:
        todo_updates_before_progress: 1
    completion_guard:
      parameters:
        warnings_before_abort: 3
  plan_bootstrap:
    strategy: soft
    max_turns: 2
    warmup_turns: 1
    seed_file: implementations/system_prompts/opencode/plan_bootstrap_protofs.yaml

enhanced_tools:
  enabled: true
  validation:
    enabled: true
    rules: [read_before_edit]
    rule_config:
      read_before_edit:
        mode: strict
        require_fresh_read: true
        max_age_seconds: 900
  diff_policy:
    patch_splitting:
      policy: reject_multi_file
      max_files_per_patch: 1
      validation_message: |
        <VALIDATION_ERROR>
        Multi-file patches are disabled in this configuration. Submit exactly one apply_unified_patch per file.
        </VALIDATION_ERROR>
      on_violation: warn_and_split

features:
  plan: true
  todos:
    enabled: true
    strict: true
    reset_streak_on_todo: true
